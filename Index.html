<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baseline ‚Äî Grid Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #f4f4f5;
      --bg-secondary: #fafafa;
      --bg-tertiary: #e4e4e7;
      --bg-elevated: #ffffff;
      --fg-primary: #18181b;
      --fg-secondary: #52525b;
      --fg-muted: #a1a1aa;
      --border-primary: #e4e4e7;
      --border-secondary: #d4d4d8;
      --accent: #52525b;
      --accent-hover: #3f3f46;
      --accent-muted: #e4e4e7;
      --lock-color: #dc2626;
      --export-color: #dc2626;
      --export-hover: #b91c1c;
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
    }

    [data-theme="dark"] {
      --bg-primary: #09090b;
      --bg-secondary: #18181b;
      --bg-tertiary: #27272a;
      --bg-elevated: #3f3f46;
      --fg-primary: #fafafa;
      --fg-secondary: #a1a1aa;
      --fg-muted: #71717a;
      --border-primary: #27272a;
      --border-secondary: #3f3f46;
      --accent: #a1a1aa;
      --accent-hover: #d4d4d8;
      --accent-muted: #3f3f46;
      --lock-color: #ef4444;
      --export-color: #ef4444;
      --export-hover: #dc2626;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.5);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--fg-primary);
      min-height: 100vh;
      font-size: 14px;
      line-height: 1.5;
      transition: background 0.2s, color 0.2s;
    }

    .app { display: flex; height: 100vh; position: relative; }

    /* Sidebar */
    .sidebar {
      width: 360px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-primary);
      overflow-y: auto;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-primary);
      background: var(--bg-secondary);
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo svg { width: 100%; height: 100%; }

    .brand-text h1 {
      font-size: 18px;
      font-weight: 700;
      color: var(--fg-primary);
      letter-spacing: -0.3px;
    }

    .brand-text p {
      font-size: 12px;
      color: var(--fg-muted);
      margin-top: 1px;
    }

    .sidebar-content { flex: 1; overflow-y: auto; padding: 12px; }

    .section {
      padding: 16px;
      margin-bottom: 8px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-primary);
    }

    .section:last-child { margin-bottom: 0; }

    .section-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--fg-muted);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .section-actions { display: flex; gap: 6px; }

    .clear-btn {
      font-size: 10px;
      padding: 4px 8px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-sm);
      color: var(--fg-muted);
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      transition: all 0.15s;
    }

    .clear-btn:hover { background: var(--bg-secondary); color: var(--fg-primary); }

    .form-group { margin-bottom: 12px; }
    .form-group:last-child { margin-bottom: 0; }

    .label-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    label {
      font-size: 12px;
      font-weight: 500;
      color: var(--fg-secondary);
    }

    .lock-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-sm);
      cursor: pointer;
      color: var(--fg-muted);
      transition: all 0.15s;
    }

    .lock-btn:hover { background: var(--bg-secondary); color: var(--fg-secondary); }
    .lock-btn.locked { background: var(--lock-color); border-color: var(--lock-color); color: white; }
    .lock-btn svg { width: 12px; height: 12px; }

    select, input[type="number"], input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-md);
      background: var(--bg-elevated);
      font-size: 13px;
      font-family: inherit;
      color: var(--fg-primary);
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--fg-muted);
      box-shadow: 0 0 0 2px var(--accent-muted);
    }

    input[type="color"] {
      width: 100%;
      height: 36px;
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-md);
      cursor: pointer;
      padding: 3px;
      background: var(--bg-elevated);
    }

    .input-row { display: flex; gap: 10px; }
    .input-row .form-group { flex: 1; }

    /* Grid Templates - Soft styling */
    .grid-category { margin-bottom: 0; }

    .grid-category-title {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      color: var(--fg-muted);
      padding: 10px 12px;
      background: var(--bg-secondary);
      margin: 0 -1px;
      border-top: 1px solid var(--border-primary);
    }

    .grid-category:first-child .grid-category-title {
      border-top: none;
      border-radius: 8px 8px 0 0;
    }

    .grid-templates {
      max-height: 320px;
      overflow-y: auto;
      border: 1px solid var(--border-primary);
      border-radius: 10px;
      background: var(--bg-secondary);
    }

    .grid-template-item {
      display: flex;
      align-items: center;
      padding: 10px 14px;
      border-bottom: 1px solid var(--border-primary);
      cursor: pointer;
      transition: background 0.15s ease;
      font-size: 13px;
      background: var(--bg-elevated);
    }

    .grid-template-item:last-child { border-bottom: none; }
    .grid-template-item:hover { background: var(--bg-tertiary); opacity: 0.95; }

    .grid-template-item input[type="checkbox"] {
      width: 16px;
      height: 16px;
      margin-right: 10px;
      accent-color: var(--fg-secondary);
      cursor: pointer;
    }

    .grid-template-item span { font-size: 13px; color: var(--fg-primary); }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 16px;
      border: none;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-primary {
      background: var(--fg-primary);
      color: var(--bg-primary);
      width: 100%;
    }

    .btn-primary:hover { opacity: 0.9; }

    .btn-secondary {
      background: var(--bg-elevated);
      color: var(--fg-primary);
      border: 1px solid var(--border-secondary);
      width: 100%;
    }

    .btn-secondary:hover { background: var(--bg-tertiary); }

    /* Canvas Area */
    .canvas-area {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      overflow: auto;
      background: var(--bg-primary);
      position: relative;
    }

    .canvas-wrapper {
      position: relative;
      box-shadow: var(--shadow-lg);
      border-radius: 2px;
    }

    .canvas-wrapper canvas { display: block; }

    /* Export Button - Top Right, Red */
    .export-btn-fixed {
      position: fixed;
      top: 16px;
      right: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: var(--export-color);
      border: none;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 600;
      font-family: inherit;
      color: white;
      cursor: pointer;
      transition: all 0.15s;
      z-index: 100;
      box-shadow: 0 8px 24px rgba(0,0,0,0.25);
    }

    .export-btn-fixed:hover { background: var(--export-hover); }
    .export-btn-fixed svg { width: 16px; height: 16px; }

    /* Theme Toggle - Bottom Right */
    .theme-toggle {
      position: fixed;
      bottom: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--bg-secondary);
      border: 1px solid var(--border-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--fg-secondary);
      transition: all 0.2s;
      z-index: 100;
      box-shadow: var(--shadow-md);
    }

    .theme-toggle:hover { background: var(--bg-tertiary); color: var(--fg-primary); }
    .theme-toggle svg { width: 18px; height: 18px; }
    .theme-toggle .sun-icon { display: none; }
    .theme-toggle .moon-icon { display: block; }
    [data-theme="dark"] .theme-toggle .sun-icon { display: block; }
    [data-theme="dark"] .theme-toggle .moon-icon { display: none; }

    /* Donation Panel - Support button 50% larger */
    .donation-trigger {
      position: fixed;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      writing-mode: vertical-rl;
      text-orientation: mixed;
      background: var(--bg-secondary);
      border: 1px solid var(--border-secondary);
      border-right: none;
      border-radius: var(--radius-lg) 0 0 var(--radius-lg);
      padding: 24px 15px;
      font-size: 18px;
      font-weight: 600;
      font-family: inherit;
      color: var(--fg-secondary);
      cursor: pointer;
      transition: all 0.3s;
      z-index: 90;
      box-shadow: var(--shadow-md);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .donation-trigger:hover { padding-right: 20px; }

    .donation-trigger .heart-icon {
      width: 24px;
      height: 24px;
      transform: rotate(90deg);
      fill: url(#heartGradient);
    }

    .donation-panel {
      position: fixed;
      right: -380px;
      top: 0;
      height: 100vh;
      width: 360px;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border-secondary);
      z-index: 200;
      transition: right 0.3s ease;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-lg);
    }

    .donation-panel.open { right: 0; }

    .donation-panel-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .donation-panel-header h2 { font-size: 16px; font-weight: 700; }

    .donation-close {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      background: var(--bg-tertiary);
      border: 1px solid var(--border-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--fg-secondary);
      transition: all 0.15s;
    }

    .donation-close:hover { background: var(--bg-elevated); color: var(--fg-primary); }
    .donation-close svg { width: 16px; height: 16px; }

    .donation-content { flex: 1; padding: 20px; overflow-y: auto; }

    .donation-message {
      font-size: 13px;
      color: var(--fg-secondary);
      line-height: 1.7;
      margin-bottom: 24px;
      padding: 16px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      border-left: 3px solid;
      border-image: linear-gradient(135deg, #ec4899, #f97316, #eab308) 1;
    }

    .share-section {
      margin-bottom: 20px;
      padding: 16px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-secondary);
      text-align: center;
    }

    .share-section p {
      font-size: 12px;
      color: var(--fg-muted);
      margin-bottom: 12px;
    }

    .share-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      background: #000;
      color: #fff;
      border: none;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s;
    }

    [data-theme="dark"] .share-btn { background: #fff; color: #000; }

    .share-btn:hover { opacity: 0.85; }
    .share-btn svg { width: 16px; height: 16px; }

    .wallet-card {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 12px;
    }

    .wallet-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }

    .wallet-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 11px;
    }

    .wallet-icon.sol { background: linear-gradient(135deg, #9945FF, #14F195); color: white; }
    .wallet-icon.eth { background: linear-gradient(135deg, #627EEA, #3C3C3D); color: white; }
    .wallet-icon.btc { background: linear-gradient(135deg, #F7931A, #FFB347); color: white; }

    .wallet-name { font-weight: 600; font-size: 14px; }

    .wallet-address {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 10px;
      color: var(--fg-muted);
      word-break: break-all;
      background: var(--bg-elevated);
      padding: 10px;
      border-radius: var(--radius-sm);
      margin-bottom: 12px;
      border: 1px solid var(--border-primary);
    }

    .wallet-actions { display: flex; gap: 8px; }

    .wallet-btn {
      flex: 1;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 600;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-family: inherit;
    }

    .wallet-btn.copy { background: var(--fg-primary); border: none; color: var(--bg-primary); }
    .wallet-btn.copy:hover { opacity: 0.9; }
    .wallet-btn.qr { background: var(--bg-elevated); border: 1px solid var(--border-secondary); color: var(--fg-primary); }
    .wallet-btn.qr:hover { background: var(--bg-secondary); }
    .wallet-btn svg { width: 12px; height: 12px; }

    /* QR Modal */
    .qr-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 300;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }

    .qr-modal.active { opacity: 1; visibility: visible; }

    .qr-modal-content {
      background: var(--bg-secondary);
      padding: 24px;
      border-radius: var(--radius-lg);
      text-align: center;
      max-width: 280px;
      border: 1px solid var(--border-secondary);
    }

    .qr-modal-content h3 { margin-bottom: 16px; font-size: 15px; }

    .qr-code {
      width: 180px;
      height: 180px;
      background: white;
      margin: 0 auto 16px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qr-code canvas { border-radius: 4px; }

    .qr-close {
      padding: 10px 24px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-md);
      cursor: pointer;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: var(--fg-primary);
      transition: all 0.15s;
    }

    .qr-close:hover { background: var(--bg-elevated); }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--fg-primary);
      color: var(--bg-primary);
      padding: 12px 24px;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 500;
      z-index: 400;
      transition: transform 0.3s ease;
      box-shadow: var(--shadow-lg);
    }

    .toast.show { transform: translateX(-50%) translateY(0); }

    /* Range input */
    input[type="range"] {
      width: 100%;
      height: 4px;
      border-radius: 2px;
      background: var(--border-secondary);
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--fg-secondary);
      cursor: pointer;
    }

    /* Opacity Control */
    .opacity-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .opacity-control input[type="range"] {
      flex: 1;
    }

    .opacity-input-wrap {
      display: flex;
      align-items: center;
      background: var(--bg-elevated);
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-md);
      padding-right: 8px;
      min-width: 65px;
    }

    .opacity-input-wrap input[type="number"] {
      width: 36px;
      border: none;
      background: transparent;
      text-align: right;
      padding: 8px 2px 8px 8px;
      -moz-appearance: textfield;
    }

    .opacity-input-wrap input[type="number"]::-webkit-outer-spin-button,
    .opacity-input-wrap input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .opacity-input-wrap input[type="number"]:focus {
      outline: none;
      box-shadow: none;
    }

    .opacity-suffix {
      font-size: 12px;
      color: var(--fg-muted);
      font-weight: 500;
    }

    /* Preview Background */
    .bg-preview-section { display: flex; flex-direction: column; gap: 12px; }

    .bg-swatches { display: flex; gap: 6px; }

    .bg-swatch {
      flex: 1;
      aspect-ratio: 1;
      max-width: 44px;
      border: 2px solid var(--border-secondary);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.15s;
      padding: 0;
      background: none;
    }

    .bg-swatch:hover { border-color: var(--fg-muted); }
    .bg-swatch.active { border-color: var(--fg-primary); }

    .bg-swatch-color { width: 100%; height: 100%; border-radius: 3px; }

    .color-input-row { display: flex; gap: 8px; align-items: flex-end; }
    .color-input-row .form-group { flex: 1; margin-bottom: 0; }
    .color-input-row .form-group.picker { flex: 0 0 50px; }

    .format-select { width: 80px; padding: 8px 6px; font-size: 11px; }

    .color-value-input { font-family: 'SF Mono', Monaco, monospace; font-size: 12px; }

    /* Scrollbar */
    .sidebar-content::-webkit-scrollbar,
    .grid-templates::-webkit-scrollbar,
    .donation-content::-webkit-scrollbar { width: 6px; }

    .sidebar-content::-webkit-scrollbar-track,
    .grid-templates::-webkit-scrollbar-track,
    .donation-content::-webkit-scrollbar-track { background: transparent; }

    .sidebar-content::-webkit-scrollbar-thumb,
    .grid-templates::-webkit-scrollbar-thumb,
    .donation-content::-webkit-scrollbar-thumb {
      background: var(--border-secondary);
      border-radius: 3px;
    }

    /* Export overlay */
    .export-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }

    .export-overlay.active { opacity: 1; visibility: visible; }

    .export-modal {
      background: var(--bg-secondary);
      padding: 32px;
      border-radius: var(--radius-lg);
      text-align: center;
      max-width: 300px;
      border: 1px solid var(--border-secondary);
    }

    .export-modal h3 { font-size: 15px; margin-bottom: 8px; }
    .export-modal p { color: var(--fg-muted); font-size: 13px; }

    .spinner {
      width: 32px;
      height: 32px;
      border: 2px solid var(--border-secondary);
      border-top-color: var(--fg-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .shortcut-hint {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 6px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-secondary);
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      color: var(--fg-muted);
      margin-left: 8px;
    }

    .donation-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.3);
      z-index: 150;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .donation-overlay.open { opacity: 1; visibility: visible; }

    .svg-defs { position: absolute; width: 0; height: 0; overflow: hidden; }
  </style>
</head>
<body>
  <svg class="svg-defs">
    <defs>
      <linearGradient id="heartGradient" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#ec4899" />
        <stop offset="50%" style="stop-color:#f97316" />
        <stop offset="100%" style="stop-color:#eab308" />
      </linearGradient>
    </defs>
  </svg>

  <div class="app">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <svg viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="1" y="1" width="34" height="34" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <line x1="12" y1="1" x2="12" y2="35" stroke="currentColor" stroke-width="1.5"/>
            <line x1="24" y1="1" x2="24" y2="35" stroke="currentColor" stroke-width="1.5"/>
            <line x1="1" y1="12" x2="35" y2="12" stroke="currentColor" stroke-width="1.5"/>
            <line x1="1" y1="24" x2="35" y2="24" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="18" cy="18" r="3" fill="currentColor"/>
          </svg>
        </div>
        <div class="brand-text">
          <h1>Baseline</h1>
          <p>Grid Generator</p>
        </div>
      </div>

      <div class="sidebar-content">
        <!-- Canvas Size -->
        <div class="section">
          <div class="section-title">Canvas Size</div>
          <div class="form-group">
            <div class="label-row"><label>Preset</label></div>
            <select id="sizePreset">
              <option value="custom">Custom Size</option>
              <optgroup label="Social Media">
                <option value="1080x1080">Instagram Post (1080√ó1080)</option>
                <option value="1080x1920">Instagram Story (1080√ó1920)</option>
                <option value="1200x630">Facebook Post (1200√ó630)</option>
                <option value="1500x500">Twitter/X Header (1500√ó500)</option>
                <option value="1000x1500">Pinterest Pin (1000√ó1500)</option>
                <option value="1280x720">YouTube Thumbnail (1280√ó720)</option>
              </optgroup>
              <optgroup label="Video">
                <option value="1920x1080">Full HD 1080p (1920√ó1080)</option>
                <option value="3840x2160">4K UHD (3840√ó2160)</option>
                <option value="1080x1920">Vertical Video (1080√ó1920)</option>
              </optgroup>
              <optgroup label="Print (300 DPI)">
                <option value="2550x3300">US Letter Portrait (8.5√ó11")</option>
                <option value="3300x2550">US Letter Landscape (11√ó8.5")</option>
                <option value="2480x3508">A4 Portrait (210√ó297mm)</option>
                <option value="3508x2480">A4 Landscape (297√ó210mm)</option>
                <option value="1200x1800">4√ó6" Photo</option>
                <option value="2400x3000">8√ó10" Photo</option>
              </optgroup>
              <optgroup label="Screen">
                <option value="1440x900">Desktop (1440√ó900)</option>
                <option value="1920x1080">Desktop HD (1920√ó1080)</option>
                <option value="375x812">iPhone SE (375√ó812)</option>
                <option value="390x844">iPhone 14 (390√ó844)</option>
              </optgroup>
            </select>
          </div>
          <div class="input-row">
            <div class="form-group">
              <div class="label-row"><label>Width</label></div>
              <input type="number" id="canvasWidth" value="1080" min="100" max="10000">
            </div>
            <div class="form-group">
              <div class="label-row"><label>Height</label></div>
              <input type="number" id="canvasHeight" value="1080" min="100" max="10000">
            </div>
          </div>
        </div>

        <!-- Grid Layouts -->
        <div class="section">
          <div class="section-title">
            <span>Grid Layouts</span>
            <div class="section-actions">
              <button class="clear-btn" id="clearGridsBtn">Clear</button>
              <button class="lock-btn" id="lockGrids">
                <svg class="unlock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
                <svg class="lock-icon" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
              </button>
            </div>
          </div>
          <div class="grid-templates" id="gridTemplates"></div>
        </div>

        <!-- Spacing -->
        <div class="section">
          <div class="section-title">Spacing</div>
          <div class="input-row">
            <div class="form-group">
              <div class="label-row">
                <label>Margin</label>
                <button class="lock-btn locked" id="lockMargin">
                  <svg class="unlock-icon" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
                  <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                </button>
              </div>
              <input type="number" id="margin" value="20" min="0" max="500">
            </div>
            <div class="form-group">
              <div class="label-row">
                <label>Padding</label>
                <button class="lock-btn locked" id="lockPadding">
                  <svg class="unlock-icon" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
                  <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                </button>
              </div>
              <input type="number" id="padding" value="20" min="0" max="500">
            </div>
          </div>
          <div class="form-group">
            <div class="label-row">
              <label>Gutter</label>
              <button class="lock-btn locked" id="lockGutter">
                <svg class="unlock-icon" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
                <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
              </button>
            </div>
            <input type="number" id="gutter" value="20" min="0" max="200">
          </div>
        </div>

        <!-- Line Style -->
        <div class="section">
          <div class="section-title">Line Style</div>
          <div class="input-row">
            <div class="form-group">
              <div class="label-row">
                <label>Weight</label>
                <button class="lock-btn locked" id="lockLineWeight">
                  <svg class="unlock-icon" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
                  <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                </button>
              </div>
              <input type="number" id="lineWeight" value="1" min="0.5" max="10" step="0.5">
            </div>
            <div class="form-group">
              <div class="label-row">
                <label>Style</label>
                <button class="lock-btn locked" id="lockLineStyle">
                  <svg class="unlock-icon" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
                  <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                </button>
              </div>
              <select id="lineStyle">
                <option value="solid">Solid</option>
                <option value="dashed">Dashed</option>
                <option value="dotted">Dotted</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="label-row">
              <label>Color</label>
              <button class="lock-btn" id="lockLineColor">
                <svg class="unlock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
                <svg class="lock-icon" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
              </button>
            </div>
            <input type="color" id="lineColor" value="#ef4444">
          </div>
          <div class="form-group">
            <div class="label-row">
              <label>Opacity</label>
              <button class="lock-btn locked" id="lockLineOpacity">
                <svg class="unlock-icon" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
                <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
              </button>
            </div>
            <div class="opacity-control">
              <input type="range" id="lineOpacity" value="70" min="10" max="100">
              <div class="opacity-input-wrap">
                <input type="number" id="opacityNumber" value="70" min="10" max="100">
                <span class="opacity-suffix">%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Preview Background -->
        <div class="section">
          <div class="section-title">Preview Background</div>
          <div class="bg-preview-section">
            <div class="bg-swatches">
              <button class="bg-swatch" data-bg="#FFFFFF"><div class="bg-swatch-color" style="background:#FFF;border:1px solid #ddd;"></div></button>
              <button class="bg-swatch" data-bg="#BFBFBF"><div class="bg-swatch-color" style="background:#BFBFBF;"></div></button>
              <button class="bg-swatch" data-bg="#808080"><div class="bg-swatch-color" style="background:#808080;"></div></button>
              <button class="bg-swatch" data-bg="#404040"><div class="bg-swatch-color" style="background:#404040;"></div></button>
              <button class="bg-swatch active" data-bg="#000000"><div class="bg-swatch-color" style="background:#000;"></div></button>
            </div>
            <div class="color-input-row">
              <div class="form-group picker">
                <label>Pick</label>
                <input type="color" id="bgColor" value="#000000">
              </div>
              <div class="form-group">
                <label>Format</label>
                <select id="colorFormat" class="format-select">
                  <option value="HEX">HEX</option>
                  <option value="RGB">RGB</option>
                  <option value="HSL">HSL</option>
                  <option value="CMYK">CMYK</option>
                </select>
              </div>
              <div class="form-group" style="flex:2;">
                <label>Value</label>
                <input type="text" id="colorValueInput" class="color-value-input" value="#000000">
              </div>
            </div>
          </div>
        </div>

        <!-- Randomize -->
        <div class="section">
          <button class="btn btn-secondary" id="randomizeBtn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/></svg>
            Randomize
            <span class="shortcut-hint">R</span>
          </button>
        </div>
      </div>
    </aside>

    <main class="canvas-area" id="canvasArea">
      <div class="canvas-wrapper" id="canvasWrapper">
        <canvas id="gridCanvas"></canvas>
      </div>
    </main>

    <!-- Export Button - Top Right, Red -->
    <button class="export-btn-fixed" id="exportBtn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
      Export PNG
    </button>

    <!-- Theme Toggle - Bottom Right -->
    <button class="theme-toggle" id="themeToggle" title="Toggle theme">
      <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
      <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
    </button>

    <!-- Support Tab - 50% larger -->
    <button class="donation-trigger" id="donationTrigger">
      <svg class="heart-icon" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
      Support
    </button>

    <div class="donation-overlay" id="donationOverlay"></div>

    <div class="donation-panel" id="donationPanel">
      <div class="donation-panel-header">
        <h2>Support Baseline</h2>
        <button class="donation-close" id="donationClose">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>
      <div class="donation-content">
        <div class="donation-message">
          Hey there! üëã<br><br>
          Thanks for using Baseline. This tool is free and always will be ‚Äî no ads, no tracking, no paywalls.<br><br>
          If it's saved you time or made your design workflow easier, consider a small donation.<br><br>Every bit helps keep this project alive and improving. ‚ú®<br><br>
          Thanks! üôè
        </div>

        <div class="wallet-card">
          <div class="wallet-header"><div class="wallet-icon sol">SOL</div><div class="wallet-name">Solana</div></div>
          <div class="wallet-address">HCvLdXCkmN4CFMwjPYAuvdLduNJYP53ziiQuCYiKdzkJ</div>
          <div class="wallet-actions">
            <button class="wallet-btn copy" data-address="HCvLdXCkmN4CFMwjPYAuvdLduNJYP53ziiQuCYiKdzkJ"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>Copy</button>
            <button class="wallet-btn qr" data-address="HCvLdXCkmN4CFMwjPYAuvdLduNJYP53ziiQuCYiKdzkJ" data-coin="SOL"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect></svg>QR</button>
          </div>
        </div>
        <div class="wallet-card">
          <div class="wallet-header"><div class="wallet-icon eth">ETH</div><div class="wallet-name">Ethereum</div></div>
          <div class="wallet-address">0x35ccffF3e9bA23EA6FD6030aE24C4fc7032E23d1</div>
          <div class="wallet-actions">
            <button class="wallet-btn copy" data-address="0x35ccffF3e9bA23EA6FD6030aE24C4fc7032E23d1"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>Copy</button>
            <button class="wallet-btn qr" data-address="0x35ccffF3e9bA23EA6FD6030aE24C4fc7032E23d1" data-coin="ETH"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect></svg>QR</button>
          </div>
        </div>
        <div class="wallet-card">
          <div class="wallet-header"><div class="wallet-icon btc">BTC</div><div class="wallet-name">Bitcoin</div></div>
          <div class="wallet-address">bc1qwsr58r24ckt2dc0p2aa2qc8gp6punt7t4tdsea</div>
          <div class="wallet-actions">
            <button class="wallet-btn copy" data-address="bc1qwsr58r24ckt2dc0p2aa2qc8gp6punt7t4tdsea"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>Copy</button>
            <button class="wallet-btn qr" data-address="bc1qwsr58r24ckt2dc0p2aa2qc8gp6punt7t4tdsea" data-coin="BTC"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect></svg>QR</button>
          </div>
        </div>

        <div class="share-section">
          <p>Not able to donate? Sharing helps too!</p>
          <button class="share-btn" id="shareBtn">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            Share on X
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="qr-modal" id="qrModal">
    <div class="qr-modal-content">
      <h3 id="qrTitle">Scan to Send</h3>
      <div class="qr-code" id="qrCode"></div>
      <button class="qr-close" id="qrClose">Close</button>
    </div>
  </div>

  <div class="toast" id="toast">Copied!</div>

  <div class="export-overlay" id="exportOverlay">
    <div class="export-modal">
      <h3>Exporting...</h3>
      <div class="spinner"></div>
      <p>Generating at full resolution</p>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script>
    const GRID_LAYOUTS = {
      'Compositional': [
        { id: 'rule-of-thirds', name: 'Rule of Thirds' },
        { id: 'fibonacci', name: 'Fibonacci' },
        { id: 'diagonal', name: 'Diagonal Lines' },
        { id: 'diagonal-triangles', name: 'Diagonal Triangles' },
        { id: 'center-lines', name: 'Center Lines' },
        { id: 'dynamic-symmetry', name: 'Dynamic Symmetry' },
        { id: 'harmonic-armature', name: 'Harmonic Armature' },
      ],
      'Editorial': [
        { id: 'manuscript', name: 'Manuscript' },
        { id: 'ratio-2-1', name: '2:1' },
        { id: 'ratio-1-2', name: '1:2' },
        { id: 'feature', name: 'Feature' },
        { id: 'pull-quote', name: 'Pull Quote' },
      ],
      'Modular': [
        { id: 'modular-2x2', name: '2√ó2 Modular' },
        { id: 'modular-3x3', name: '3√ó3 Modular' },
        { id: 'modular-4x4', name: '4√ó4 Modular' },
        { id: 'modular-4x6', name: '4√ó6 Modular' },
        { id: 'modular-5x5', name: '5√ó5 Modular' },
        { id: 'modular-6x6', name: '6√ó6 Modular' },
      ],
      'Technical': [
        { id: 'isometric', name: 'Isometric' },
        { id: 'perspective-1pt', name: '1-Point Perspective' },
        { id: 'perspective-2pt', name: '2-Point Perspective' },
        { id: 'perspective-3pt', name: '3-Point Perspective' },
        { id: 'vanishing-center', name: 'Vanishing Center' },
        { id: 'radial', name: 'Radial' },
      ],
      'Rhythm': [
        { id: 'field-grid', name: 'Field' },
        { id: 'musical', name: 'Musical' },
        { id: 'progressive', name: 'Progressive' },
        { id: 'fibonacci-rhythm', name: 'Fibonacci Rhythm' },
        { id: 'phi-sections', name: 'Phi Sections' },
        { id: 'fifths', name: 'Fifths' },
      ],
      'Standard': [
        { id: 'standard-4', name: 'Standard (4px)' },
        { id: 'standard-8', name: 'Standard (8px)' },
        { id: 'standard-12', name: 'Standard (12px)' },
        { id: 'standard-24', name: 'Standard (24px)' },
        { id: 'standard-48', name: 'Standard (48px)' },
      ],
      'Baseline': [
        { id: 'baseline-4', name: 'Baseline (4px)' },
        { id: 'baseline-8', name: 'Baseline (8px)' },
        { id: 'baseline-12', name: 'Baseline (12px)' },
        { id: 'baseline-24', name: 'Baseline (24px)' },
        { id: 'baseline-48', name: 'Baseline (48px)' },
      ],
      'Columns': [
        { id: 'columns-2', name: '2 Columns' },
        { id: 'columns-3', name: '3 Columns' },
        { id: 'columns-4', name: '4 Columns' },
        { id: 'columns-5', name: '5 Columns' },
        { id: 'columns-6', name: '6 Columns' },
        { id: 'columns-8', name: '8 Columns' },
        { id: 'columns-12', name: '12 Columns' },
      ],
      'Rows': [
        { id: 'rows-2', name: '2 Rows' },
        { id: 'rows-3', name: '3 Rows' },
        { id: 'rows-4', name: '4 Rows' },
        { id: 'rows-6', name: '6 Rows' },
        { id: 'rows-8', name: '8 Rows' },
        { id: 'rows-12', name: '12 Rows' },
      ],
      'Compound': [
        { id: 'compound-2-4', name: '2+4' },
        { id: 'compound-3-6', name: '3+6' },
        { id: 'compound-4-12', name: '4+12' },
        { id: 'compound-2-3-6', name: '2+3+6' },
        { id: 'nested-phi', name: 'Nested Phi' },
        { id: 'asymmetric-compound', name: 'Asymmetric' },
      ],
      'Sacred Geometry': [
        { id: 'circle', name: 'Circle' },
        { id: 'vesica-piscis', name: 'Vesica Piscis' },
        { id: 'trinity', name: 'Trinity' },
        { id: 'tetrad', name: 'Tetrad' },
        { id: 'quintet', name: 'Quintet' },
        { id: 'seed-of-life', name: 'Seed of Life' },
        { id: 'flower-of-life', name: 'Flower of Life' },
        { id: 'sri-yantra', name: 'Sri Yantra' },
        { id: 'metatrons-cube', name: 'Metatron\'s Cube' },
      ],
    };

    const ALL_GRIDS = Object.values(GRID_LAYOUTS).flat();

    let state = {
      width: 1080, height: 1080,
      selectedGrids: ['fibonacci'],
      margin: 20, padding: 20, gutter: 20,
      lineWeight: 1, lineStyle: 'solid', lineColor: '#ef4444', lineOpacity: 70,
      bgColor: '#000000'
    };

    let locks = { grids: false, margin: true, padding: true, gutter: true, lineWeight: true, lineStyle: true, lineColor: false, lineOpacity: true };
    let colorFormat = 'HEX';

    const canvas = document.getElementById('gridCanvas');
    const ctx = canvas.getContext('2d');
    const canvasArea = document.getElementById('canvasArea');

    // Theme
    document.getElementById('themeToggle').addEventListener('click', () => {
      const newTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    });
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);

    // Donation
    const donationPanel = document.getElementById('donationPanel');
    const donationOverlay = document.getElementById('donationOverlay');
    let donationTimeout;
    document.getElementById('donationTrigger').addEventListener('mouseenter', () => { clearTimeout(donationTimeout); donationPanel.classList.add('open'); donationOverlay.classList.add('open'); });
    document.getElementById('donationTrigger').addEventListener('mouseleave', () => { donationTimeout = setTimeout(() => { if (!donationPanel.matches(':hover')) closeDonation(); }, 200); });
    donationPanel.addEventListener('mouseenter', () => clearTimeout(donationTimeout));
    donationPanel.addEventListener('mouseleave', () => donationTimeout = setTimeout(closeDonation, 200));
    document.getElementById('donationClose').addEventListener('click', closeDonation);
    donationOverlay.addEventListener('click', closeDonation);
    function closeDonation() { donationPanel.classList.remove('open'); donationOverlay.classList.remove('open'); }

    // Share on X
    document.getElementById('shareBtn').addEventListener('click', () => {
      const text = encodeURIComponent( 'Use Baseline to generate grids for your designs.\n\n' +
    'https://baselinegrids.netlify.app/\n\n' +
    'Created by: @samhayek_\n\n' +
    '100% free, forever.');
      window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank', 'width=550,height=420');
    });

    // Wallets
    document.querySelectorAll('.wallet-btn.copy').forEach(b => b.addEventListener('click', async () => { await navigator.clipboard.writeText(b.dataset.address); showToast('Address copied!'); }));
    document.querySelectorAll('.wallet-btn.qr').forEach(b => b.addEventListener('click', () => showQR(b.dataset.address, b.dataset.coin)));
    const qrModal = document.getElementById('qrModal');
    function showQR(addr, coin) { document.getElementById('qrCode').innerHTML = ''; document.getElementById('qrTitle').textContent = `Scan to Send ${coin}`; new QRCode(document.getElementById('qrCode'), { text: addr, width: 160, height: 160, colorDark: '#000', colorLight: '#fff' }); qrModal.classList.add('active'); }
    document.getElementById('qrClose').addEventListener('click', () => qrModal.classList.remove('active'));
    qrModal.addEventListener('click', e => { if (e.target === qrModal) qrModal.classList.remove('active'); });
    function showToast(msg) { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }

    // Color
    const colorFormatSelect = document.getElementById('colorFormat');
    const colorValueInput = document.getElementById('colorValueInput');
    colorFormatSelect.addEventListener('change', e => { colorFormat = e.target.value; updateColorDisplay(); });
    colorValueInput.addEventListener('change', e => { const hex = parseColorInput(e.target.value.trim()); if (hex) { state.bgColor = hex; document.getElementById('bgColor').value = hex; document.querySelectorAll('.bg-swatch').forEach(s => s.classList.remove('active')); updateColorDisplay(); render(); } });

    function parseColorInput(v) {
      if (/^#?[0-9A-Fa-f]{6}$/.test(v)) return v.startsWith('#') ? v : '#' + v;
      if (/^#?[0-9A-Fa-f]{3}$/.test(v)) { const c = v.replace('#', ''); return '#' + c[0]+c[0]+c[1]+c[1]+c[2]+c[2]; }
      const rgb = v.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);
      if (rgb) return '#' + [rgb[1],rgb[2],rgb[3]].map(x => parseInt(x).toString(16).padStart(2,'0')).join('');
      const hsl = v.match(/hsl\s*\(\s*(\d+)\s*,\s*(\d+)%?\s*,\s*(\d+)%?\s*\)/i);
      if (hsl) return hslToHex(+hsl[1], +hsl[2], +hsl[3]);
      const cmyk = v.match(/cmyk\s*\(\s*(\d+)%?\s*,\s*(\d+)%?\s*,\s*(\d+)%?\s*,\s*(\d+)%?\s*\)/i);
      if (cmyk) return cmykToHex(+cmyk[1], +cmyk[2], +cmyk[3], +cmyk[4]);
      return null;
    }
    function hslToHex(h,s,l) { s/=100;l/=100;const a=s*Math.min(l,1-l);const f=n=>{const k=(n+h/30)%12;return l-a*Math.max(Math.min(k-3,9-k,1),-1);};return '#'+[f(0),f(8),f(4)].map(x=>Math.round(x*255).toString(16).padStart(2,'0')).join(''); }
    function cmykToHex(c,m,y,k) { c/=100;m/=100;y/=100;k/=100;return '#'+[Math.round(255*(1-c)*(1-k)),Math.round(255*(1-m)*(1-k)),Math.round(255*(1-y)*(1-k))].map(x=>x.toString(16).padStart(2,'0')).join(''); }
    function hexToCmyk(hex) { const r=parseInt(hex.slice(1,3),16)/255,g=parseInt(hex.slice(3,5),16)/255,b=parseInt(hex.slice(5,7),16)/255;const k=1-Math.max(r,g,b);if(k===1)return{c:0,m:0,y:0,k:100};return{c:Math.round((1-r-k)/(1-k)*100),m:Math.round((1-g-k)/(1-k)*100),y:Math.round((1-b-k)/(1-k)*100),k:Math.round(k*100)}; }
    function updateColorDisplay() {
      const hex = state.bgColor;
      if (colorFormat === 'HEX') colorValueInput.value = hex.toUpperCase();
      else if (colorFormat === 'RGB') colorValueInput.value = `rgb(${parseInt(hex.slice(1,3),16)}, ${parseInt(hex.slice(3,5),16)}, ${parseInt(hex.slice(5,7),16)})`;
      else if (colorFormat === 'HSL') { const r=parseInt(hex.slice(1,3),16)/255,g=parseInt(hex.slice(3,5),16)/255,b=parseInt(hex.slice(5,7),16)/255;const mx=Math.max(r,g,b),mn=Math.min(r,g,b);let h=0,s=0,l=(mx+mn)/2;if(mx!==mn){const d=mx-mn;s=l>0.5?d/(2-mx-mn):d/(mx+mn);switch(mx){case r:h=((g-b)/d+(g<b?6:0))/6;break;case g:h=((b-r)/d+2)/6;break;case b:h=((r-g)/d+4)/6;break;}}colorValueInput.value=`hsl(${Math.round(h*360)}, ${Math.round(s*100)}%, ${Math.round(l*100)}%)`; }
      else if (colorFormat === 'CMYK') { const {c,m,y,k}=hexToCmyk(hex);colorValueInput.value=`cmyk(${c}%, ${m}%, ${y}%, ${k}%)`; }
    }

    document.querySelectorAll('.bg-swatch').forEach(s => s.addEventListener('click', () => { document.querySelectorAll('.bg-swatch').forEach(x => x.classList.remove('active')); s.classList.add('active'); state.bgColor = s.dataset.bg; document.getElementById('bgColor').value = state.bgColor; updateColorDisplay(); render(); }));

    // Locks
    function initLocks() {
      const m = { lockGrids:'grids', lockMargin:'margin', lockPadding:'padding', lockGutter:'gutter', lockLineWeight:'lineWeight', lockLineStyle:'lineStyle', lockLineColor:'lineColor', lockLineOpacity:'lineOpacity' };
      Object.entries(m).forEach(([id, key]) => {
        const btn = document.getElementById(id);
        if (btn) btn.addEventListener('click', () => { locks[key] = !locks[key]; updateLock(btn, locks[key]); });
      });
    }
    function updateLock(btn, locked) { btn.classList.toggle('locked', locked); btn.querySelector('.unlock-icon').style.display = locked ? 'none' : 'block'; btn.querySelector('.lock-icon').style.display = locked ? 'block' : 'none'; }

    document.getElementById('clearGridsBtn').addEventListener('click', () => { state.selectedGrids = []; document.querySelectorAll('#gridTemplates input').forEach(c => c.checked = false); render(); });

    function initGridTemplates() {
      const container = document.getElementById('gridTemplates');
      Object.entries(GRID_LAYOUTS).forEach(([cat, grids]) => {
        const div = document.createElement('div');
        div.className = 'grid-category';
        div.innerHTML = `<div class="grid-category-title">${cat}</div>`;
        grids.forEach(g => {
          const item = document.createElement('div');
          item.className = 'grid-template-item';
          item.innerHTML = `<input type="checkbox" id="grid-${g.id}" ${state.selectedGrids.includes(g.id)?'checked':''}><span>${g.name}</span>`;
          item.addEventListener('click', e => { if (e.target.tagName !== 'INPUT') item.querySelector('input').checked = !item.querySelector('input').checked; updateSelectedGrids(); });
          div.appendChild(item);
        });
        container.appendChild(div);
      });
    }

    function updateSelectedGrids() { state.selectedGrids = [...document.querySelectorAll('#gridTemplates input:checked')].map(c => c.id.replace('grid-', '')); render(); }

    document.getElementById('sizePreset').addEventListener('change', e => { if (e.target.value !== 'custom') { const [w,h] = e.target.value.split('x').map(Number); document.getElementById('canvasWidth').value = w; document.getElementById('canvasHeight').value = h; state.width = w; state.height = h; render(); } });

    ['canvasWidth','canvasHeight','margin','padding','gutter','lineWeight'].forEach(id => {
      document.getElementById(id).addEventListener('input', e => { const key = id === 'canvasWidth' ? 'width' : id === 'canvasHeight' ? 'height' : id; state[key] = parseFloat(e.target.value) || 0; if (id.includes('canvas')) document.getElementById('sizePreset').value = 'custom'; render(); });
    });

    document.getElementById('lineStyle').addEventListener('change', e => { state.lineStyle = e.target.value; render(); });
    document.getElementById('lineColor').addEventListener('input', e => { state.lineColor = e.target.value; render(); });
    document.getElementById('lineOpacity').addEventListener('input', e => { state.lineOpacity = +e.target.value; document.getElementById('opacityNumber').value = state.lineOpacity; render(); });
    document.getElementById('opacityNumber').addEventListener('input', e => { let val = Math.min(100, Math.max(10, +e.target.value || 10)); state.lineOpacity = val; document.getElementById('lineOpacity').value = val; render(); });
    document.getElementById('opacityNumber').addEventListener('blur', e => { e.target.value = state.lineOpacity; });
    document.getElementById('bgColor').addEventListener('input', e => { state.bgColor = e.target.value; document.querySelectorAll('.bg-swatch').forEach(s => s.classList.remove('active')); updateColorDisplay(); render(); });

    function randomize() {
      if (!locks.grids) { const n = Math.floor(Math.random()*3)+1; state.selectedGrids = [...ALL_GRIDS].sort(() => Math.random()-0.5).slice(0,n).map(g => g.id); document.querySelectorAll('#gridTemplates input').forEach(c => c.checked = state.selectedGrids.includes(c.id.replace('grid-',''))); }
      if (!locks.lineStyle) { state.lineStyle = ['solid','dashed','dotted'][Math.floor(Math.random()*3)]; document.getElementById('lineStyle').value = state.lineStyle; }
      if (!locks.lineColor) { state.lineColor = ['#ef4444','#f97316','#eab308','#22c55e','#14b8a6','#0ea5e9','#8b5cf6','#ec4899'][Math.floor(Math.random()*8)]; document.getElementById('lineColor').value = state.lineColor; }
      if (!locks.lineOpacity) { state.lineOpacity = Math.floor(Math.random()*50)+50; document.getElementById('lineOpacity').value = state.lineOpacity; document.getElementById('opacityNumber').value = state.lineOpacity; }
      if (!locks.lineWeight) { state.lineWeight = (Math.floor(Math.random()*6)+1)*0.5; document.getElementById('lineWeight').value = state.lineWeight; }
      if (!locks.margin) { state.margin = Math.floor(Math.random()*4)*20; document.getElementById('margin').value = state.margin; }
      if (!locks.padding) { state.padding = (Math.floor(Math.random()*4)+1)*20; document.getElementById('padding').value = state.padding; }
      if (!locks.gutter) { state.gutter = (Math.floor(Math.random()*4)+1)*10; document.getElementById('gutter').value = state.gutter; }
      render();
    }

    document.getElementById('randomizeBtn').addEventListener('click', randomize);
    document.addEventListener('keydown', e => { if ((e.key === 'r' || e.key === 'R') && !['INPUT','SELECT'].includes(e.target.tagName)) randomize(); });

    document.getElementById('exportBtn').addEventListener('click', async () => {
      document.getElementById('exportOverlay').classList.add('active');
      await new Promise(r => setTimeout(r, 100));
      const ec = document.createElement('canvas'); ec.width = state.width; ec.height = state.height;
      drawAllGrids(ec.getContext('2d'), state.width, state.height, 1);
      const link = document.createElement('a'); link.download = `baseline-${state.width}x${state.height}-${Date.now()}.png`; link.href = ec.toDataURL('image/png'); link.click();
      document.getElementById('exportOverlay').classList.remove('active');
    });

    function render() {
      const rect = canvasArea.getBoundingClientRect();
      const scale = Math.min((rect.width - 80) / state.width, (rect.height - 80) / state.height, 1);
      const dw = Math.floor(state.width * scale), dh = Math.floor(state.height * scale);
      canvas.width = dw; canvas.height = dh; canvas.style.width = dw + 'px'; canvas.style.height = dh + 'px';
      ctx.fillStyle = state.bgColor; ctx.fillRect(0, 0, dw, dh);
      drawAllGrids(ctx, dw, dh, scale);
    }

    function drawAllGrids(c, w, h, scale) {
      const sp = state.padding * scale, sm = state.margin * scale, sg = state.gutter * scale, sw = Math.max(state.lineWeight * scale, 0.5);
      c.strokeStyle = hexToRgba(state.lineColor, state.lineOpacity / 100);
      c.lineWidth = sw;
      c.setLineDash(state.lineStyle === 'dashed' ? [sw*8, sw*4] : state.lineStyle === 'dotted' ? [sw, sw*3] : []);
      const dx = sm, dy = sm, dw = w - sm*2, dh = h - sm*2;
      const cx = dx + sp, cy = dy + sp, cw = dw - sp*2, ch = dh - sp*2;
      state.selectedGrids.forEach(id => drawGrid(c, id, cx, cy, cw, ch, sg, scale));
      if (state.margin > 0) c.strokeRect(dx, dy, dw, dh);
      if (state.padding > 0) c.strokeRect(cx, cy, cw, ch);
    }

    function drawGrid(c, id, x, y, w, h, g, s) {
      c.beginPath();
      const phi = 1.618;
      const cx = x + w/2, cy = y + h/2;
      const r = Math.min(w, h) * 0.4; // 80% of half = 40% for radius, fills ~80%

      switch(id) {
        case 'rule-of-thirds': c.moveTo(x+w/3,y);c.lineTo(x+w/3,y+h);c.moveTo(x+2*w/3,y);c.lineTo(x+2*w/3,y+h);c.moveTo(x,y+h/3);c.lineTo(x+w,y+h/3);c.moveTo(x,y+2*h/3);c.lineTo(x+w,y+2*h/3);break;
        case 'fibonacci': drawGoldenSpiral(c,x,y,w,h);break;
        case 'diagonal': c.moveTo(x,y);c.lineTo(x+w,y+h);c.moveTo(x+w,y);c.lineTo(x,y+h);break;
        case 'diagonal-triangles': c.moveTo(x,y);c.lineTo(x+w,y+h);c.moveTo(x+w,y);c.lineTo(x,y+h);c.moveTo(x+w/2,y);c.lineTo(x,y+h);c.moveTo(x+w/2,y);c.lineTo(x+w,y+h);c.moveTo(x,y);c.lineTo(x+w/2,y+h);c.moveTo(x+w,y);c.lineTo(x+w/2,y+h);break;
        case 'center-lines': c.moveTo(x+w/2,y);c.lineTo(x+w/2,y+h);c.moveTo(x,y+h/2);c.lineTo(x+w,y+h/2);break;
        case 'dynamic-symmetry': c.moveTo(x,y);c.lineTo(x+w,y+h);c.moveTo(x+w,y);c.lineTo(x,y+h);c.moveTo(x,y);c.lineTo(x+w,y+h*0.618);c.moveTo(x+w,y);c.lineTo(x,y+h*0.618);c.moveTo(x,y+h);c.lineTo(x+w,y+h*0.382);c.moveTo(x+w,y+h);c.lineTo(x,y+h*0.382);break;
        case 'harmonic-armature': c.moveTo(x,y);c.lineTo(x+w,y+h);c.moveTo(x+w,y);c.lineTo(x,y+h);c.moveTo(x+w/2,y);c.lineTo(x,y+h);c.moveTo(x+w/2,y);c.lineTo(x+w,y+h);c.moveTo(x,y+h/2);c.lineTo(x+w,y);c.moveTo(x,y+h/2);c.lineTo(x+w,y+h);c.moveTo(x+w,y+h/2);c.lineTo(x,y);c.moveTo(x+w,y+h/2);c.lineTo(x,y+h);break;
        case 'manuscript': c.strokeRect(x+w*0.1,y,w*0.8,h);break;
        case 'ratio-2-1': { const a21=(w-g)/3;c.strokeRect(x,y,a21*2,h);c.strokeRect(x+a21*2+g,y,a21,h);break; }
        case 'ratio-1-2': { const a12=(w-g)/3;c.strokeRect(x,y,a12,h);c.strokeRect(x+a12+g,y,a12*2,h);break; }
        case 'feature': { const fw=w*0.6;c.strokeRect(x,y,fw,h*0.65);c.strokeRect(x,y+h*0.65+g,fw,h*0.35-g);c.strokeRect(x+fw+g,y,w-fw-g,h);break; }
        case 'pull-quote': { c.strokeRect(x,y,w,h);c.strokeRect(x+w*0.15,y+h*0.35,w*0.7,h*0.3);break; }
        case 'modular-2x2': drawMod(c,x,y,w,h,2,2,g);break;
        case 'modular-3x3': drawMod(c,x,y,w,h,3,3,g);break;
        case 'modular-4x4': drawMod(c,x,y,w,h,4,4,g);break;
        case 'modular-4x6': drawMod(c,x,y,w,h,4,6,g);break;
        case 'modular-5x5': drawMod(c,x,y,w,h,5,5,g);break;
        case 'modular-6x6': drawMod(c,x,y,w,h,6,6,g);break;
        case 'isometric': drawIso(c,x,y,w,h,s);break;
        case 'perspective-1pt': draw1P(c,x,y,w,h);break;
        case 'perspective-2pt': draw2P(c,x,y,w,h);break;
        case 'perspective-3pt': draw3P(c,x,y,w,h);break;
        case 'vanishing-center': for(let i=0;i<12;i++){const a=(i/12)*Math.PI*2;c.moveTo(cx,cy);c.lineTo(cx+Math.cos(a)*w,cy+Math.sin(a)*h);}break;
        case 'radial': { const rr=Math.min(w,h)/2;for(let i=1;i<=5;i++){c.moveTo(cx+rr*i/5,cy);c.arc(cx,cy,rr*i/5,0,Math.PI*2);}for(let i=0;i<8;i++){const a=(i/8)*Math.PI*2;c.moveTo(cx,cy);c.lineTo(cx+Math.cos(a)*rr,cy+Math.sin(a)*rr);}break; }
        case 'field-grid': { const fc=4,fgr=6,fgw=w/fc,fgh=h/fgr;for(let i=0;i<=fc;i++){c.moveTo(x+i*fgw,y);c.lineTo(x+i*fgw,y+h);}for(let i=0;i<=fgr;i++){c.moveTo(x,y+i*fgh);c.lineTo(x+w,y+i*fgh);}break; }
        case 'musical': [0,0.125,0.25,0.333,0.5,0.667,0.75,0.875,1].forEach(v=>{c.moveTo(x,y+h*v);c.lineTo(x+w,y+h*v);});break;
        case 'progressive': { const ms=[0,0.08,0.18,0.3,0.45,0.62,0.8,1];ms.forEach(v=>{c.moveTo(x,y+h*v);c.lineTo(x+w,y+h*v);});break; }
        case 'fibonacci-rhythm': [0,1,1,2,3,5,8,13,21].reduce((a,v,i)=>{if(i>0){const p=a/34;c.moveTo(x,y+h*p);c.lineTo(x+w,y+h*p);}return a+v;},0);break;
        case 'phi-sections': [0,1-1/phi,1/phi,1-(1/phi/phi),1/phi/phi,1].forEach(v=>{c.moveTo(x,y+h*v);c.lineTo(x+w,y+h*v);});break;
        case 'fifths': [0,0.2,0.4,0.6,0.8,1].forEach(v=>{c.moveTo(x,y+h*v);c.lineTo(x+w,y+h*v);});break;
        case 'standard-4': drawStd(c,x,y,w,h,4*s);break;
        case 'standard-8': drawStd(c,x,y,w,h,8*s);break;
        case 'standard-12': drawStd(c,x,y,w,h,12*s);break;
        case 'standard-24': drawStd(c,x,y,w,h,24*s);break;
        case 'standard-48': drawStd(c,x,y,w,h,48*s);break;
        case 'baseline-4': drawBase(c,x,y,w,h,4*s);break;
        case 'baseline-8': drawBase(c,x,y,w,h,8*s);break;
        case 'baseline-12': drawBase(c,x,y,w,h,12*s);break;
        case 'baseline-24': drawBase(c,x,y,w,h,24*s);break;
        case 'baseline-48': drawBase(c,x,y,w,h,48*s);break;
        case 'columns-2':case 'columns-3':case 'columns-4':case 'columns-5':case 'columns-6':case 'columns-8':case 'columns-12': drawCols(c,x,y,w,h,+id.split('-')[1],g);break;
        case 'rows-2':case 'rows-3':case 'rows-4':case 'rows-6':case 'rows-8':case 'rows-12': drawRows(c,x,y,w,h,+id.split('-')[1],g);break;
        case 'compound-2-4': drawCols(c,x,y,w,h,2,g);c.globalAlpha=0.4;drawCols(c,x,y,w,h,4,g/2);c.globalAlpha=1;break;
        case 'compound-3-6': drawCols(c,x,y,w,h,3,g);c.globalAlpha=0.4;drawCols(c,x,y,w,h,6,g/2);c.globalAlpha=1;break;
        case 'compound-4-12': drawCols(c,x,y,w,h,4,g);c.globalAlpha=0.4;drawCols(c,x,y,w,h,12,g/3);c.globalAlpha=1;break;
        case 'compound-2-3-6': drawCols(c,x,y,w,h,2,g);c.globalAlpha=0.5;drawCols(c,x,y,w,h,3,g*0.7);c.globalAlpha=0.3;drawCols(c,x,y,w,h,6,g/2);c.globalAlpha=1;break;
        case 'nested-phi': { const ng1=w/phi,ng2=ng1/phi;c.moveTo(x+ng1,y);c.lineTo(x+ng1,y+h);c.moveTo(x+w-ng1,y);c.lineTo(x+w-ng1,y+h);c.moveTo(x+ng2,y);c.lineTo(x+ng2,y+h);c.moveTo(x+w-ng2,y);c.lineTo(x+w-ng2,y+h);const ngh1=h/phi,ngh2=ngh1/phi;c.moveTo(x,y+ngh1);c.lineTo(x+w,y+ngh1);c.moveTo(x,y+h-ngh1);c.lineTo(x+w,y+h-ngh1);c.moveTo(x,y+ngh2);c.lineTo(x+w,y+ngh2);c.moveTo(x,y+h-ngh2);c.lineTo(x+w,y+h-ngh2);break; }
        case 'asymmetric-compound': { const acw=w/3;c.strokeRect(x,y,acw,h);const acg=(w-acw-g);const acc=(acg-g*5)/6;for(let i=0;i<6;i++)c.strokeRect(x+acw+g+i*(acc+g),y,acc,h);break; }
        // Sacred Geometry - all fill ~80% of canvas
        case 'circle': c.moveTo(cx+r,cy);c.arc(cx,cy,r,0,Math.PI*2);break;
        case 'vesica-piscis': { const vr=r*0.75;c.moveTo(cx-vr*0.4+vr,cy);c.arc(cx-vr*0.4,cy,vr,0,Math.PI*2);c.moveTo(cx+vr*0.4+vr,cy);c.arc(cx+vr*0.4,cy,vr,0,Math.PI*2);break; }
        case 'trinity': for(let i=0;i<3;i++){const a=i*Math.PI*2/3-Math.PI/2;const px=cx+r*0.35*Math.cos(a),py=cy+r*0.35*Math.sin(a);c.moveTo(px+r*0.7,py);c.arc(px,py,r*0.7,0,Math.PI*2);}break;
        case 'tetrad': for(let i=0;i<4;i++){const a=i*Math.PI/2;const px=cx+r*0.4*Math.cos(a),py=cy+r*0.4*Math.sin(a);c.moveTo(px+r*0.65,py);c.arc(px,py,r*0.65,0,Math.PI*2);}break;
        case 'quintet': for(let i=0;i<5;i++){const a=i*Math.PI*2/5-Math.PI/2;const px=cx+r*0.45*Math.cos(a),py=cy+r*0.45*Math.sin(a);c.moveTo(px+r*0.58,py);c.arc(px,py,r*0.58,0,Math.PI*2);}break;
        case 'seed-of-life': { const sr=r*0.5;c.moveTo(cx+sr,cy);c.arc(cx,cy,sr,0,Math.PI*2);for(let i=0;i<6;i++){const a=i*Math.PI/3;const px=cx+sr*Math.cos(a),py=cy+sr*Math.sin(a);c.moveTo(px+sr,py);c.arc(px,py,sr,0,Math.PI*2);}break; }
        case 'flower-of-life': { const flr=r*0.28;c.moveTo(cx+flr,cy);c.arc(cx,cy,flr,0,Math.PI*2);for(let ring=0;ring<2;ring++){const dist=flr*(ring+1);for(let i=0;i<6;i++){const a=i*Math.PI/3+(ring*Math.PI/6);const px=cx+dist*Math.cos(a),py=cy+dist*Math.sin(a);c.moveTo(px+flr,py);c.arc(px,py,flr,0,Math.PI*2);}}for(let i=0;i<6;i++){const a=i*Math.PI/3;const px=cx+flr*2*Math.cos(a),py=cy+flr*2*Math.sin(a);c.moveTo(px+flr,py);c.arc(px,py,flr,0,Math.PI*2);}break; }
        case 'sri-yantra': drawSriYantra(c,cx,cy,r);break;
        case 'metatrons-cube': drawMetatron(c,cx,cy,r);break;
      }
      c.stroke();
    }

    function drawCols(c,x,y,w,h,n,g){const cw=(w-g*(n-1))/n;for(let i=0;i<n;i++){const cx=x+i*(cw+g);c.moveTo(cx,y);c.lineTo(cx,y+h);c.moveTo(cx+cw,y);c.lineTo(cx+cw,y+h);}}
    function drawRows(c,x,y,w,h,n,g){const rh=(h-g*(n-1))/n;for(let i=0;i<n;i++){const ry=y+i*(rh+g);c.moveTo(x,ry);c.lineTo(x+w,ry);c.moveTo(x,ry+rh);c.lineTo(x+w,ry+rh);}}
    function drawMod(c,x,y,w,h,cols,rows,g){const cw=(w-g*(cols-1))/cols,rh=(h-g*(rows-1))/rows;for(let col=0;col<cols;col++)for(let row=0;row<rows;row++)c.rect(x+col*(cw+g),y+row*(rh+g),cw,rh);}
    function drawBase(c,x,y,w,h,sp){for(let py=y;py<=y+h;py+=sp){c.moveTo(x,py);c.lineTo(x+w,py);}}
    function drawStd(c,x,y,w,h,sp){for(let py=y;py<=y+h;py+=sp){c.moveTo(x,py);c.lineTo(x+w,py);}for(let px=x;px<=x+w;px+=sp){c.moveTo(px,y);c.lineTo(px,y+h);}}
    function drawIso(c,x,y,w,h,s){const sp=40*s,a=Math.tan(30*Math.PI/180);for(let i=-h;i<w+h;i+=sp){c.moveTo(x+i,y+h);c.lineTo(x+i+h/a,y);c.moveTo(x+i,y+h);c.lineTo(x+i-h/a,y);}for(let px=x;px<=x+w;px+=sp){c.moveTo(px,y);c.lineTo(px,y+h);}}
    function draw1P(c,x,y,w,h){const cx=x+w/2,cy=y+h/2;[[x,y],[x+w,y],[x+w,y+h],[x,y+h],[x+w/2,y],[x+w,cy],[x+w/2,y+h],[x,cy]].forEach(p=>{c.moveTo(cx,cy);c.lineTo(p[0],p[1]);});c.moveTo(x,cy);c.lineTo(x+w,cy);}
    function draw2P(c,x,y,w,h){const hy=y+h*0.4,lv=x-w*0.1,rv=x+w*1.1;c.moveTo(x,hy);c.lineTo(x+w,hy);for(let i=0;i<=4;i++){c.moveTo(lv,hy);c.lineTo(x+w,y+h*i/4);c.moveTo(rv,hy);c.lineTo(x,y+h*i/4);}}
    function draw3P(c,x,y,w,h){const hy=y+h*0.3,lv=x-w*0.1,rv=x+w*1.1,bv=y+h*1.3;c.moveTo(x,hy);c.lineTo(x+w,hy);for(let i=0;i<=3;i++){c.moveTo(lv,hy);c.lineTo(x+w,y+h*i/3);c.moveTo(rv,hy);c.lineTo(x,y+h*i/3);}for(let i=0;i<=4;i++){c.moveTo(x+w*i/4,y);c.lineTo(x+w/2,bv);}}
    function drawGoldenSpiral(c,x,y,w,h){const p=1.618;let cx=x,cy=y,cw=w,ch=h;for(let i=0;i<8;i++){if(i%4===0){const nw=cw/p;c.moveTo(cx+nw,cy);c.lineTo(cx+nw,cy+ch);cx+=nw;cw-=nw;}else if(i%4===1){const nh=ch/p;c.moveTo(cx,cy+ch-nh);c.lineTo(cx+cw,cy+ch-nh);ch-=nh;}else if(i%4===2){const nw=cw/p;c.moveTo(cx+cw-nw,cy);c.lineTo(cx+cw-nw,cy+ch);cw-=nw;}else{const nh=ch/p;c.moveTo(cx,cy+nh);c.lineTo(cx+cw,cy+nh);cy+=nh;ch-=nh;}}}

    function drawSriYantra(c,cx,cy,r){
      const s=r*1.1;
      // 9 interlocking triangles - 4 pointing up, 5 pointing down
      const upTris=[
        [[0,-0.95],[-.85,.65],[.85,.65]],
        [[0,-0.65],[-.55,.4],[.55,.4]],
        [[0,-0.4],[-.35,.22],[.35,.22]],
        [[0,-0.2],[-.18,.1],[.18,.1]],
      ];
      const dnTris=[
        [[0,.95],[-.85,-.5],[.85,-.5]],
        [[0,.7],[-.65,-.35],[.65,-.35]],
        [[0,.48],[-.45,-.22],[.45,-.22]],
        [[0,.3],[-.28,-.12],[.28,-.12]],
        [[0,.15],[-.12,-.05],[.12,-.05]],
      ];
      [...upTris,...dnTris].forEach(tri=>{
        c.moveTo(cx+tri[0][0]*s,cy+tri[0][1]*s);
        c.lineTo(cx+tri[1][0]*s,cy+tri[1][1]*s);
        c.lineTo(cx+tri[2][0]*s,cy+tri[2][1]*s);
        c.closePath();
      });
    }

    function drawMetatron(c,cx,cy,r){
      const pts=[];
      for(let i=0;i<6;i++)pts.push([cx+r*Math.cos(i*Math.PI/3-Math.PI/2),cy+r*Math.sin(i*Math.PI/3-Math.PI/2)]);
      for(let i=0;i<6;i++)pts.push([cx+r*0.5*Math.cos(i*Math.PI/3-Math.PI/2+Math.PI/6),cy+r*0.5*Math.sin(i*Math.PI/3-Math.PI/2+Math.PI/6)]);
      pts.push([cx,cy]);
      for(let i=0;i<pts.length;i++)for(let j=i+1;j<pts.length;j++){c.moveTo(pts[i][0],pts[i][1]);c.lineTo(pts[j][0],pts[j][1]);}
    }

    function hexToRgba(hex,a){return `rgba(${parseInt(hex.slice(1,3),16)},${parseInt(hex.slice(3,5),16)},${parseInt(hex.slice(5,7),16)},${a})`;}

    initLocks();
    initGridTemplates();
    updateColorDisplay();
    render();
    window.addEventListener('resize', render);
  </script>
</body>
</html>
